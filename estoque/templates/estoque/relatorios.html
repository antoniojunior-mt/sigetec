{% extends 'estoque/base.html' %}

{% block title %}Relatórios Avançados - SEGITEC{% endblock %}

{% block content %}
    <h1>Relatórios Avançados</h1>
    <hr>

    <div class="card bg-light mb-4">
        <div class="card-body">
            <h5 class="card-title">Filtros</h5>
            <form method="get"> <div class="row align-items-end">
                    <div class="col-md-4 mb-3">{{ form.periodo.label_tag }} {{ form.periodo }}</div>
                    <div class="col-md-5 mb-3">{{ form.item.label_tag }} {{ form.item }}</div>
                    <div class="col-md-3 mb-3 d-flex">
                        <button type="submit" class="btn btn-primary w-100 me-2">Filtrar</button>
                        <button type="submit" formaction="{% url 'estoque:relatorios_pdf' %}" class="btn btn-success w-100">PDF</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <h2 class="mt-5">Relatório de Movimentação por Período</h2>
    <table class="table table-hover table-bordered">
        <thead class="table-light">
            <tr>
                <th>Escola</th>
                <th>Item Recebido</th>
                <th>Quantidade Total no Período</th>
            </tr>
        </thead>
        <tbody>
            {% for linha in relatorio_periodo %}
            <tr>
                <td>{{ linha.escola__nome }}</td>
                <td>{{ linha.item__nome }}</td>
                <td>{{ linha.total_quantidade }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="text-center">Nenhum dado encontrado para os filtros selecionados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2 class="mt-5">Relatório de Desempenho por Item</h2>
    <table class="table table-hover table-bordered">
        <thead class="table-light">
            <tr>
                <th>Nome do Item</th>
                <th>Total de Saídas no Período</th>
                <th>Escola que Mais Recebeu no Período</th>
            </tr>
        </thead>
        <tbody>
            {% for item in relatorio_por_item %}
            <tr>
                <td>{{ item.nome }}</td>
                <td>{{ item.total_saida }}</td>
                <td>{{ item.escola_que_mais_recebeu }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="text-center">Nenhum dado encontrado para os filtros selecionados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
